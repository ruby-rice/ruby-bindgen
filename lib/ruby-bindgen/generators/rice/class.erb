<%- has_incomplete_classes = !incomplete_classes.to_s.empty? -%>
<%- if has_incomplete_classes -%>
<%# Split: define class, define incomplete inner classes, then add methods -%>
<%= auto_generated_base -%>
<%- if under && base -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class_under<<%= qualified_class_name_cpp(cursor) %>, <%= base %>>(<%= under.cruby_name %>, "<%= cursor.type.spelling.split("::").last.camelize %>");
<%- elsif under -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class_under<<%= qualified_class_name_cpp(cursor) %>>(<%= under.cruby_name %>, "<%= cursor.type.spelling.split("::").last.camelize %>");
<%- elsif base -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class<<%= qualified_class_name_cpp(cursor) %>, <%= base %>>("<%= cursor.type.spelling.split("::").last.camelize %>");
<%- else -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class<<%= qualified_class_name_cpp(cursor) %>>("<%= cursor.type.spelling.split("::").last.camelize %>");
<%- end -%>

<%= incomplete_classes -%>
<%- unless children.empty? -%>

<%= cursor.cruby_name %>.
<%= children -%>
<%- end -%>
<%- else -%>
<%# No incomplete classes - single statement -%>
<%- line_terminator = children.empty? ? ";" : "." -%>
<%= auto_generated_base -%>
<%- if under && base -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class_under<<%= qualified_class_name_cpp(cursor) %>, <%= base %>>(<%= under.cruby_name %>, "<%= cursor.type.spelling.split("::").last.camelize %>")<%= line_terminator %>
<%- elsif under -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class_under<<%= qualified_class_name_cpp(cursor) %>>(<%= under.cruby_name %>, "<%= cursor.type.spelling.split("::").last.camelize %>")<%= line_terminator %>
<%- elsif base -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class<<%= qualified_class_name_cpp(cursor) %>, <%= base %>>("<%= cursor.type.spelling.split("::").last.camelize %>")<%= line_terminator %>
<%- else -%>
Rice::Data_Type<<%= qualified_class_name_cpp(cursor) %>> <%= cursor.cruby_name %> = define_class<<%= qualified_class_name_cpp(cursor) %>>("<%= cursor.type.spelling.split("::").last.camelize %>")<%= line_terminator %>
<%- end -%>
<%= children -%>
<%- end -%>
